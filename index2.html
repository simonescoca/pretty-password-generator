<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Password Generator</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <style>
      header > .container {
        height: 100px;
      }

      header #Switch-container {
        height: 40px;
        width: 70px;
        cursor: pointer;
        background: #f0f0f0;
        box-shadow: inset 0 0 8px rgba(0,0,0,0.1);
        transition: background 0.3s ease;
      }

      header #Switch {
        height: 35px;
        width: 35px;
        position: absolute;
        background: #fff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        left: 1.5px;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 0.3s ease;
      }

      body.dark-mode header #Switch-container {
        background: #2d2d2d;
        box-shadow: inset 0 0 8px rgba(0,0,0,0.3);
      }

      body.dark-mode header #Switch {
        transform: translateX(calc(100% - 5px)) translateY(-50%);
        background: #424242;
      }

      main > .container {
        height: calc(100vh - 4rem - 150px);
      }

      main #Slider-pill #Copy {
        background-color: #5546CC;
        color: #FFFFFF;
        font-size: 25px;
        border: 0.5px solid #8b46cc;
        transition: all 0.2s ease;
      }

      #Copy:active {
        transform: scale(92%, 92%);
      }

      main #Slider-pill #Pw-display {
        font-family: "Courier Prime", monospace;
        font-size: 21px;
      }

      @media screen and (max-width: 575px) {
        #Slider-pill {
          height: 100%;
          width: 70px;
        }
        #Slider-pill .rounded-circle {
          width: 100%;
          height: 70px;
        }
        #Pw-display {
          height: calc(100% - 140px);
          width: 100%;
        }
        #Pw-display .Block {
          width: 100%;
          height: 20%;
        }
        #Pw-display .Block.has-next::after {
          content: " ";
          display: table;
          position: absolute;
          bottom: -1px;
          left: 50%;
          transform: translate(-50%, 50%);
          background: black;
          height: 1.7px;
          width: 10px;
          border-radius: 1px;
        }
      }

      @media screen and (min-width: 576px) {
        #Slider-pill {
          height: 70px;
          width: 100%;
        }
        #Slider-pill .rounded-circle {
          height: 100%;
          width: 70px;
        }
        #Pw-display {
          width: calc(100% - 140px);
          height: 100%;
        }
        #Pw-display .Block {
          height: 100%;
          width: 20%;
        }
        #Pw-display .Block.has-next::after {
          content: " ";
          display: table;
          position: absolute;
          right: -1px;
          top: 50%;
          transform: translate(50%, -50%);
          background: black;
          height: 1.7px;
          width: 10px;
          border-radius: 1px;
        }
      }

      @media screen and (min-width: 768px) {
        #Slider-pill {
          width: 560px;
        }
      }

      #copyNotification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #d4edda;
        color: #155724;
        padding: 10px 20px;
        border-radius: 5px;
        border: 1px solid #c3e6cb;
        display: none;
        z-index: 9999;
        font-family: Arial, sans-serif;
        font-size: 16px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }

      body.dark-mode {
        background-color: #121212;
        color: #e0e0e0;
      }

      body.dark-mode #copyNotification {
        background: #155724;
        color: #d4edda;
        border-color: #0c3318;
      }

      body.dark-mode .Block.has-next::after {
        background: #e0e0e0 !important;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="d-flex container justify-content-between align-items-center mt-3">
        <h1 class="Title">Password Generator</h1>
        <div>
          <label
            id="Switch-container"
            for="Mode-button"
            class="border border-primary rounded-pill position-relative"
          >
            <div
              id="Switch"
              class="border border-primary rounded-circle d-flex justify-content-center align-items-center position-absolute"
            ></div>
          </label>
          <input type="checkbox" id="Mode-button" class="d-none" />
        </div>
      </div>
    </header>
    <main>
      <div class="d-flex container mt-1">
        <div
          id="Slider-pill"
          class="m-auto mx-sm-auto mt-sm-3 border border-danger rounded-pill d-flex flex-column flex-sm-row justify-content-between align-items-center position-relative"
        >
          <div id="Copy" class="rounded-circle d-flex justify-content-center align-items-center">
            <i class="fa-regular fa-copy"></i>
          </div>
          <div id="Pw-display" class="d-sm-flex">
            <section class="Block d-flex justify-content-center align-items-center position-relative"></section>
            <section class="Block d-flex justify-content-center align-items-center position-relative"></section>
            <section class="Block d-flex justify-content-center align-items-center position-relative"></section>
            <section class="Block d-flex justify-content-center align-items-center position-relative"></section>
            <section class="Block d-flex justify-content-center align-items-center position-relative"></section>
          </div>
          <div class="rounded-circle"></div>
          <div id="Slider" class="bg-danger rounded-circle position-absolute"></div>
        </div>
      </div>
    </main>
    <div id="copyNotification">
      <i class="fas fa-check" style="margin-right: 8px;"></i> Password copiata
    </div>
    <script>
      const slider = document.getElementById("Slider");
      const sliderPill = document.getElementById("Slider-pill");
      const modeButton = document.getElementById("Mode-button");
      let currentLevel = 0;
      let isDragging = false;
      let dragAxis = window.innerWidth < 576 ? "vertical" : "horizontal";
      let startPointerPos = 0;
      let startSliderPos = 0;
      let initialLevel = 0;
      let hasCrossedBoundary = false;

      function genRandomIndex(len) {
        const arr = new Uint32Array(1);
        window.crypto.getRandomValues(arr);
        return arr[0] % len;
      }

      function generatePw(level) {
        const ABC = "ABCDEFGHJKLMNPQRSTUVWXYZ".split("");
        const abc = "abcdefghijkmnopqrstuvwxyz".split("");
        const nums = "0123456789".split("");
        const chars = "!@#$%&*?.".split("");
        let password, checkCap, checkLow, checkNum, checkSC;
        do {
          password = "";
          checkCap = checkLow = checkNum = checkSC = false;
          for (let i = 0; i < 4 * level; i++) {
            const boundary = (i % 4 === 0 || i % 4 === 3);
            const options = boundary
              ? [ABC[genRandomIndex(ABC.length)], abc[genRandomIndex(abc.length)], nums[genRandomIndex(nums.length)]]
              : [ABC[genRandomIndex(ABC.length)], abc[genRandomIndex(abc.length)], nums[genRandomIndex(nums.length)], chars[genRandomIndex(chars.length)]];
            const chosen = options[genRandomIndex(options.length)];
            password += chosen;
            if (ABC.includes(chosen)) checkCap = true;
            if (abc.includes(chosen)) checkLow = true;
            if (nums.includes(chosen)) checkNum = true;
            if (chars.includes(chosen)) checkSC = true;
          }
        } while (!(checkCap && checkLow && checkNum && checkSC));
        return password.match(/.{1,4}/g).join("-");
      }

      function updatePasswordDisplay(level) {
        const pwDisplay = document.getElementById("Pw-display");
        const blocks = pwDisplay.querySelectorAll(".Block");
        
        blocks.forEach(block => {
          block.textContent = "";
          block.classList.remove("has-next");
        });

        if (level === 0) return;

        const password = generatePw(level);
        const groups = password.split("-");

        blocks.forEach((block, index) => {
          if(index < groups.length) {
            block.textContent = groups[index];
            const nextBlock = blocks[index + 1];
            if(nextBlock && groups[index + 1]) {
              block.classList.add("has-next");
            }
          }
        });
      }

      function setInitialPosition() {
        dragAxis = window.innerWidth < 576 ? "vertical" : "horizontal";
        slider.style.top = "0px";
        slider.style.left = "0px";
        currentLevel = 0;
        updatePasswordDisplay(0);
      }

      function getPointerPosition(e) {
        return e.touches ? 
          { x: e.touches[0].clientX, y: e.touches[0].clientY } : 
          { x: e.clientX, y: e.clientY };
      }

      function getSnapPositions() {
        const pillRect = sliderPill.getBoundingClientRect();
        const blocks = document.querySelectorAll("#Pw-display .Block");
        let snaps = [0];
        
        blocks.forEach(block => {
          const blockRect = block.getBoundingClientRect();
          snaps.push(dragAxis === "vertical" ? 
            blockRect.bottom - pillRect.top : 
            blockRect.right - pillRect.left
          );
        });
        return snaps;
      }

      function calculateCurrentLevel(currentPos, snaps) {
        let level = 0;
        for (let i = snaps.length - 1; i >= 0; i--) {
          if (snaps[i] <= currentPos) {
            level = i;
            break;
          }
        }
        return level;
      }

      function dragStart(e) {
        e.preventDefault();
        isDragging = true;
        initialLevel = currentLevel;
        hasCrossedBoundary = false;
        dragAxis = window.innerWidth < 576 ? "vertical" : "horizontal";
        const pointerPos = getPointerPosition(e);
        const sliderPos = dragAxis === "vertical" ? 
          parseInt(slider.style.top) || 0 : 
          parseInt(slider.style.left) || 0;
        
        startPointerPos = dragAxis === "vertical" ? pointerPos.y : pointerPos.x;
        startSliderPos = sliderPos;

        document.addEventListener("mousemove", dragMove);
        document.addEventListener("mouseup", dragEnd);
        document.addEventListener("touchmove", dragMove, { passive: false });
        document.addEventListener("touchend", dragEnd);
      }

      function dragMove(e) {
        if (!isDragging) return;
        e.preventDefault();
        const pointerPos = getPointerPosition(e);
        const delta = (dragAxis === "vertical" ? 
          pointerPos.y - startPointerPos : 
          pointerPos.x - startPointerPos);
        
        let newPos = startSliderPos + delta;
        const snaps = getSnapPositions();
        newPos = Math.max(snaps[0], Math.min(snaps[snaps.length - 1], newPos));

        const targetLevel = calculateCurrentLevel(newPos, snaps);
        
        if (targetLevel !== currentLevel) {
          hasCrossedBoundary = true;
          currentLevel = targetLevel;
          updatePasswordDisplay(currentLevel);
        }

        dragAxis === "vertical" ? 
          slider.style.top = newPos + "px" : 
          slider.style.left = newPos + "px";
      }

      function dragEnd(e) {
        isDragging = false;
        ["mousemove", "mouseup", "touchmove", "touchend"].forEach(event => 
          document.removeEventListener(event, dragEnd)
        );

        const snaps = getSnapPositions();
        const currentPos = dragAxis === "vertical" ? 
          parseInt(slider.style.top) || 0 : 
          parseInt(slider.style.left) || 0;
        
        let closestIndex = 0;
        snaps.forEach((snap, index) => {
          if (Math.abs(snap - currentPos) < Math.abs(snaps[closestIndex] - currentPos)) {
            closestIndex = index;
          }
        });

        if (closestIndex !== currentLevel || (closestIndex === initialLevel && hasCrossedBoundary)) {
          currentLevel = closestIndex;
          updatePasswordDisplay(currentLevel);
        }

        dragAxis === "vertical" ? 
          slider.style.top = snaps[closestIndex] + "px" : 
          slider.style.left = snaps[closestIndex] + "px";
      }

      function moveSliderToLevel(newLevel) {
        const snaps = getSnapPositions();
        newLevel = Math.max(0, Math.min(snaps.length - 1, newLevel));
        
        dragAxis === "vertical" ? 
          slider.style.top = snaps[newLevel] + "px" : 
          slider.style.left = snaps[newLevel] + "px";
        
        currentLevel = newLevel;
        updatePasswordDisplay(newLevel);
      }

      function showCopyNotification() {
        const notif = document.getElementById("copyNotification");
        notif.style.display = "block";
        setTimeout(() => notif.style.display = "none", 2000);
      }

      function copyPassword() {
        const password = Array.from(document.querySelectorAll("#Pw-display .Block"))
          .map(block => block.textContent)
          .filter(text => text)
          .join("-");
        
        if (!password) return;

        if (navigator.clipboard?.writeText) {
          navigator.clipboard.writeText(password).then(showCopyNotification);
        } else {
          const textArea = document.createElement("textarea");
          textArea.value = password;
          textArea.style.position = "fixed";
          document.body.appendChild(textArea);
          textArea.select();
          try { document.execCommand("copy") && showCopyNotification(); } catch(e) {}
          document.body.removeChild(textArea);
        }
      }

      function modeLogic() {
        document.body.classList.toggle("dark-mode", modeButton.checked);
      }

      document.addEventListener("keydown", (e) => {
        const isDesktop = !("ontouchstart" in window);
        let newLevel = currentLevel;
        
        switch(e.key) {
          case 'ArrowUp': case 'Up':
            newLevel = window.innerWidth < 576 ? currentLevel - 1 : currentLevel + 1;
            break;
          case 'ArrowDown': case 'Down':
            newLevel = window.innerWidth < 576 ? currentLevel + 1 : currentLevel - 1;
            break;
          case 'ArrowRight': case 'Right':
            newLevel++;
            break;
          case 'ArrowLeft': case 'Left':
            newLevel--;
            break;
          case 'Enter':
            if (isDesktop) copyPassword();
            break;
        }
        
        if (newLevel !== currentLevel) moveSliderToLevel(newLevel);
      });

      const copyDiv = document.getElementById("Copy");
      copyDiv.addEventListener("pointerup", copyPassword);
      copyDiv.addEventListener("click", copyPassword);
      copyDiv.addEventListener("keydown", (e) => e.key === 'Enter' && copyPassword());

      modeButton.addEventListener("change", modeLogic);
      window.addEventListener("resize", setInitialPosition);
      slider.addEventListener("mousedown", dragStart);
      slider.addEventListener("touchstart", dragStart, { passive: false });

      document.addEventListener("DOMContentLoaded", modeLogic);
    </script>
  </body>
</html>